<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

		<title>gemc stream xsplit plugin</title>
		
		<!-- CSS -->
		<link rel="stylesheet" type="text/css" href="./style.css" />
		
		<!-- Libraries -->
		<script src="js/libs/xjs.js"></script>
		<script src="js/libs/jquery.min.js"></script>
		<script src="js/libs/createjs_1.1_min.js"></script>
		<script src="js/libs/zim_10.0.1.js"></script>
		<script src='js/libs/Vector3.js'></script>
		
		<!-- Classes -->
		<script src='js/ch/gemc/myresults/results/ResumeTable.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/ColumnConfig.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/TableCellHeader.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/TableCell.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/TableCell.POS.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/TableCell.DRIVER.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/TableRowHeader.js'></script>
		<script src='js/ch/gemc/myresults/results/resumeTableClasses/TableRow.js'></script>

		<!-- Modules ?.. -->
		<script src='js/ResumeTableCanvas_module.js'></script>
		
	</head>
	
	
	<body>
		
		<canvas id='fxCanvas'></canvas>
		
		<div id='resumeTableDiv'></div>
		
		<div class='window' id='windowID'>
			<div class='smalltable'>
				<div id='smalltable'></div>
			</div>
			<div id='debugDiv'>debug</div>
			</div>
			<div class='gemclogo'>
				<div id='timeleft' class='timeleft'></div>
				<div id='eventname' class='eventname'></div>
			</div>
			<span id='countdowntimer' class='countdowntimer'></span>
		</div>
		
		<script>

			// setup, the resume table.. (canvas)
			Application.ResumeTableCanvas.setTargetId ('resumeTableDiv');
			
			var messageCount = 0;

			var socket				= new WebSocket ('ws://192.168.1.129:8787');
				socket.onmessage	= function (event)
									{
										var data = JSON.parse (event.data);

										// DEBUG: count message..
										document.getElementById ('debugDiv').innerHTML = ++messageCount;
										
										// event name..
										document.getElementById("eventname").innerHTML = data.EVENT.METADATA.GROUP;

										// small table..
										var htmlsmalltable = "<table class ='small'><tr>";
										for (i = 0; i < data.EVENT.DATA.length; i++) {
											htmlsmalltable += "<td><div class='pos'>P" +  data.EVENT.DATA[i].INDEX + "</div></br><b>" + data.EVENT.DATA[i].PILOT + "</b></br>L" + data.EVENT.DATA[i].LAPS + ": " + data.EVENT.DATA[i].ABSOLUTTIME + "</br>L:" + data.EVENT.DATA[i].LAPTIME + " B:" + data.EVENT.DATA[i].BESTTIME + "</td>"
										}
										htmlsmalltable += "</tr></table>";
										document.getElementById("smalltable").innerHTML = htmlsmalltable;

										// timeleft..
										if (data.EVENT.METADATA.COUNTDOWN == "00:00:00"){
											document.getElementById("timeleft").innerHTML = data.EVENT.METADATA.REMAININGTIME;
										} else {
											document.getElementById("timeleft").innerHTML = data.EVENT.METADATA.COUNTDOWN;
										}
										
										// countdown..
										if (data.EVENT.METADATA.COUNTDOWN == "00:00:30") {
											Application.ResumeTableCanvas.fadeOut	(1000);
										}
										
										if (data.EVENT.METADATA.CURRENTTIME == data.EVENT.METADATA.RACETIME) {
											Application.ResumeTableCanvas.setData	(data);
											Application.ResumeTableCanvas.fadeIn	(1000);
										}
										
										if (data.EVENT.METADATA.CURRENTTIME == "00:00:01") {
											Application.ResumeTableCanvas.fadeOut	(0);
										}
										
										if (data.EVENT.METADATA.COUNTDOWN == "00:00:11") {
											var timeleft = 11;
											var downloadTimer = setInterval(function(){
											timeleft--;
											
											if(timeleft < 1) {
													if (timeleft == 0) {
													$("#countdowntimer").fadeIn(250);
													document.getElementById("countdowntimer").textContent = "Go!";
													$("#countdowntimer").fadeOut(1000);
													clearInterval(downloadTimer);
													}
											}
											else {
												$("#countdowntimer").fadeIn(0);
												document.getElementById("countdowntimer").textContent = timeleft;
												$("#countdowntimer").fadeOut(1000);
											}
											},1000);
										}	

									};

		</script>

	</body>

</html>